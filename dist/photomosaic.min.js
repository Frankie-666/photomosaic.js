/*
 *  photomosaic.js - v
 *  A javascript plugin that creates a photomosaic of an image
 *  https://github.com/ritz078/photomosaic.js#readme
 *
 *  Made by Ritesh Kumar
 *  Under MIT License
 */
!function(a){"use-strict";function b(a){if(!a.image)throw new Error("image options is not passed");if(!a.targetElement)throw new Error("targetElement is not passed in options");this.options=this.extend(this.defaults,a),this.options.image.complete?this.process():this.options.image.onload=this.process}b.prototype.process=function(){this.options.divX=Math.floor(this.options.width/this.options.tileWidth),this.options.divY=Math.floor(this.options.height/this.options.tileHeight);var a=this.renderImage();this.tileCanvas(a)},b.prototype.extend=function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a},b.prototype.defaults={image:null,tileWidth:5,tileHeight:5,targetElement:null,tileShape:"circle",opacity:1,width:null,height:null},b.prototype.renderImage=function(){var a=this.options,b=document.createElement("canvas");b.width=a.tileWidth*a.divX,b.height=a.tileHeight*a.divY;var c=b.getContext("2d");return c.drawImage(a.image,0,0,b.width,b.height),c},b.prototype.getAverageColor=function(a){for(var b=-4,c=5,d=0,e={r:0,g:0,b:0},f=a.length;(b+=4*c)<f;)d++,e.r+=a[b],e.g+=a[b+1],e.b+=a[b+2];return e.r=Math.floor(e.r/d),e.g=Math.floor(e.g/d),e.b=Math.floor(e.b/d),e},b.prototype.tileCanvas=function(a){var b=document.createElement("canvas");b.width=a.canvas.width,b.height=a.canvas.height;for(var c=b.getContext("2d"),d=this.options,e=0;e<d.divY;e++)for(var f=0;f<d.divX;f++){var g=f*d.tileWidth,h=e*d.tileHeight,i=a.getImageData(g,h,d.tileWidth,d.tileHeight),j=this.getAverageColor(i.data),k="rgba("+j.r+","+j.g+","+j.b+","+this.options.opacity+")";c.fillStyle=k,this.createMosaic(g,h,c)}this.options.targetElement.append(b)},b.prototype.createMosaic=function(a,b,c){var d=this.options.tileWidth,e=this.options.tileHeight;if("circle"===this.options.tileShape){var f=a+d/2,g=b+e/2,h=Math.min(d,e)/2;c.beginPath(),c.arc(f,g,h,0,2*Math.PI),c.closePath(),c.fill()}else if("rectangle"===this.options.tileShape){var i=e,j=d;c.beginPath(),c.rect(a,b,j,i),c.closePath(),c.fill()}},a.PhotoMosaic=b}(window);